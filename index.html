<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Platformer</title>
<style>
  body { margin:0; background:#111; color:white; font-family:Arial; text-align:center;}
  canvas { background:#222; display:block; margin:0 auto; border:2px solid #555;}
</style>
</head>
<body>
<h2>Platformer â€” Arrow Keys to Move/Jump</h2>
<canvas id="game" width="800" height="450"></canvas>
<div id="ui"></div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const ui = document.getElementById("ui");

let keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

// ---------- GAME DATA ----------
const gravity = 0.5;
const moveSpeed = 3;
const jumpPower = 8;
const maxJumpHold = 18;

let levelIndex = 0;
let startTime = null;
let finished = false;

const levels = [
{
  start:{x:40,y:350},
  goal:{x:740,y:320,w:40,h:40},
  platforms:[
    {x:0,y:400,w:800,h:50},
    {x:200,y:320,w:120,h:20},
    {x:380,y:260,w:120,h:20},
    {x:560,y:200,w:120,h:20}
  ],
  hazards:[{x:320,y:390,w:60,h:10}]
},
{
  start:{x:40,y:350},
  goal:{x:740,y:80,w:40,h:40},
  platforms:[
    {x:0,y:400,w:800,h:50},
    {x:120,y:300,w:100,h:20},
    {x:260,y:230,w:100,h:20},
    {x:400,y:160,w:100,h:20},
    {x:560,y:100,w:120,h:20}
  ],
  hazards:[{x:0,y:390,w:200,h:10},{x:300,y:390,w:200,h:10}]
},
{
  start:{x:40,y:350},
  goal:{x:720,y:350,w:40,h:40},
  platforms:[
    {x:0,y:400,w:800,h:50},
    {x:200,y:340,w:80,h:20},
    {x:350,y:300,w:80,h:20},
    {x:500,y:260,w:80,h:20},
    {x:650,y:220,w:80,h:20}
  ],
  hazards:[
    {x:280,y:390,w:80,h:10},
    {x:440,y:390,w:80,h:10}
  ]
},
{
  start:{x:40,y:350},
  goal:{x:740,y:60,w:40,h:40},
  platforms:[
    {x:0,y:400,w:800,h:50},
    {x:150,y:320,w:120,h:20},
    {x:350,y:250,w:120,h:20},
    {x:550,y:180,w:120,h:20},
    {x:300,y:120,w:120,h:20}
  ],
  hazards:[
    {x:0,y:390,w:150,h:10},
    {x:650,y:390,w:150,h:10}
  ]
},
{
  start:{x:40,y:350},
  goal:{x:740,y:350,w:40,h:40},
  platforms:[
    {x:0,y:400,w:800,h:50},
    {x:150,y:350,w:80,h:20},
    {x:300,y:300,w:80,h:20},
    {x:450,y:250,w:80,h:20},
    {x:600,y:200,w:80,h:20}
  ],
  hazards:[
    {x:220,y:390,w:80,h:10},
    {x:380,y:390,w:80,h:10},
    {x:540,y:390,w:80,h:10}
  ]
}
];

let player;

function resetPlayer(){
  const s = levels[levelIndex].start;
  player = {
    x:s.x, y:s.y,
    w:20, h:20,
    vx:0, vy:0,
    onGround:false,
    jumpHold:0
  };
}

function nextLevel(){
  levelIndex++;
  if(levelIndex>=levels.length){
    finished = true;
    return;
  }
  resetPlayer();
}

function resetLevel(){
  resetPlayer();
}

resetPlayer();

// ---------- COLLISION ----------
function rectIntersect(a,b){
  return a.x<a.x+a.w && a.x < b.x+b.w &&
         a.x+a.w > b.x &&
         a.y+a.h > b.y &&
         a.y < b.y+b.h;
}

// ---------- UPDATE ----------
function update(){
  if(finished) return;

  if(!startTime) startTime = performance.now();

  // movement
  if(keys["ArrowLeft"]) player.vx = -moveSpeed;
  else if(keys["ArrowRight"]) player.vx = moveSpeed;
  else player.vx = 0;

  // jump start
  if(keys["ArrowUp"] && player.onGround){
    player.vy = -jumpPower;
    player.onGround = false;
    player.jumpHold = 0;
  }

  // hold jump for higher jump
  if(keys["ArrowUp"] && player.jumpHold < maxJumpHold && player.vy < 0){
    player.vy -= 0.25;
    player.jumpHold++;
  }

  player.vy += gravity;

  player.x += player.vx;
  player.y += player.vy;

  // platforms
  player.onGround = false;
  for(const p of levels[levelIndex].platforms){
    if(player.x < p.x+p.w &&
       player.x+player.w > p.x &&
       player.y+player.h > p.y &&
       player.y+player.h < p.y + 20 &&
       player.vy >=0){
        player.y = p.y - player.h;
        player.vy = 0;
        player.onGround = true;
    }
  }

  // hazards
  for(const h of levels[levelIndex].hazards){
    if(player.x < h.x+h.w &&
       player.x+player.w > h.x &&
       player.y < h.y+h.h &&
       player.y+player.h > h.y){
        resetLevel();
        return;
    }
  }

  // goal
  const g = levels[levelIndex].goal;
  if(player.x < g.x+g.w &&
     player.x+player.w > g.x &&
     player.y < g.y+g.h &&
     player.y+player.h > g.y){
      nextLevel();
  }

  // fall off map
  if(player.y > canvas.height+50){
    resetLevel();
  }
}

// ---------- DRAW ----------
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(finished){
    ctx.fillStyle="white";
    ctx.font="40px Arial";
    ctx.fillText("Finished!", 300,200);
    const time = ((performance.now()-startTime)/1000).toFixed(2);
    ctx.fillText("Total Time: "+time+"s", 250,260);
    return;
  }

  // player
  ctx.fillStyle="cyan";
  ctx.fillRect(player.x,player.y,player.w,player.h);

  // platforms
  ctx.fillStyle="#888";
  for(const p of levels[levelIndex].platforms){
    ctx.fillRect(p.x,p.y,p.w,p.h);
  }

  // hazards
  ctx.fillStyle="red";
  for(const h of levels[levelIndex].hazards){
    ctx.fillRect(h.x,h.y,h.w,h.h);
  }

  // goal
  const g = levels[levelIndex].goal;
  ctx.fillStyle="lime";
  ctx.fillRect(g.x,g.y,g.w,g.h);

  // timer
  const t = ((performance.now()-startTime)/1000).toFixed(2);
  ctx.fillStyle="white";
  ctx.font="18px Arial";
  ctx.fillText("Time: "+t+"s",10,20);
  ctx.fillText("Level: "+(levelIndex+1)+"/5",10,40);
}

// ---------- LOOP ----------
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
