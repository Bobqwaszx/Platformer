<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Platformer Boss Edition</title>
<style>
body{margin:0;background:#111;color:white;font-family:Arial;text-align:center}
canvas{background:#222;display:block;margin:0 auto;border:2px solid #555}
</style>
</head>
<body>
<h2>Platformer Boss Edition</h2>
<canvas id="game" width="900" height="500"></canvas>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

let keys={};
document.addEventListener("keydown",e=>{
keys[e.key]=true;
if(e.key==="r") resetLevel();
});
document.addEventListener("keyup",e=>keys[e.key]=false);

let gravity=0.5;
let jumpPower=9;
let maxJumpHold=18;

let levelIndex=0;
let startTime=null;
let finished=false;
let deaths=0;

let boss=null;
let bossShots=[];

const levels=[
{
theme:"grass",
start:{x:50,y:420},
goal:{x:820,y:380,w:40,h:40},
platforms:[
{x:0,y:460,w:900,h:40},
{x:220,y:380,w:120,h:20},
{x:420,y:300,w:120,h:20},
{x:620,y:220,w:120,h:20}
],
hazards:[]
},
{
theme:"ice",
start:{x:50,y:420},
goal:{x:820,y:120,w:40,h:40},
platforms:[
{x:0,y:460,w:900,h:40},
{x:150,y:350,w:140,h:20},
{x:380,y:260,w:140,h:20},
{x:650,y:180,w:140,h:20}
],
hazards:[{x:250,y:450,w:200,h:10}]
},
{
theme:"walljump",
start:{x:50,y:420},
goal:{x:820,y:60,w:40,h:40},
platforms:[
{x:0,y:460,w:900,h:40},
{x:300,y:340,w:20,h:120},
{x:500,y:220,w:20,h:120},
{x:700,y:100,w:20,h:120}
],
hazards:[]
},
{
theme:"lava",
start:{x:50,y:420},
goal:{x:820,y:80,w:40,h:40},
platforms:[
{x:0,y:460,w:900,h:40},
{x:200,y:360,w:100,h:20},
{x:350,y:280,w:100,h:20},
{x:520,y:200,w:100,h:20},
{x:700,y:140,w:100,h:20}
],
hazards:[]
},
{
theme:"boss",
start:{x:50,y:420},
goal:{x:820,y:60,w:40,h:40},
platforms:[
{x:0,y:460,w:900,h:40},
{x:250,y:350,w:120,h:20},
{x:520,y:260,w:120,h:20}
],
hazards:[]
}
];

let player;

function resetPlayer(){
const s=levels[levelIndex].start;
player={
x:s.x,y:s.y,w:22,h:22,
vx:0,vy:0,
onGround:false,
jumpHold:0,
jumpsLeft:2,
touchingWall:false,
jumpPressed:false
};

bossShots=[];
if(levels[levelIndex].theme==="boss"){
boss={x:750,y:380,w:40,h:40,hp:5,cooldown:0};
}
}

function resetLevel(){
deaths++;
resetPlayer();
}

function nextLevel(){
levelIndex++;
if(levelIndex>=levels.length){finished=true;return;}
resetPlayer();
}

resetPlayer();

function rect(a,b){
return a.x<a.x+a.w&&
a.x<b.x+b.w&&
a.x+a.w>b.x&&
a.y+a.h>b.y&&
a.y<b.y+b.h;
}

function update(){
if(finished)return;
if(!startTime)startTime=performance.now();

let lvl=levels[levelIndex];

// movement
let accel=0.6;
let maxSpeed=4;
if(lvl.theme==="ice"){accel=0.2;maxSpeed=5;}

if(keys["ArrowLeft"]) player.vx-=accel;
if(keys["ArrowRight"]) player.vx+=accel;
player.vx*=0.9;
if(player.vx>maxSpeed)player.vx=maxSpeed;
if(player.vx<-maxSpeed)player.vx=-maxSpeed;

// jump + double + wall jump
if(keys["ArrowUp"] && !player.jumpPressed){
if(player.jumpsLeft>0){
player.vy=-jumpPower;
player.jumpsLeft--;
player.jumpHold=0;
}
else if(player.touchingWall){
player.vy=-jumpPower;
player.vx*= -1.2; // push off wall
}
player.jumpPressed=true;
}
if(!keys["ArrowUp"]) player.jumpPressed=false;

// hold jump higher
if(keys["ArrowUp"]&&player.jumpHold<maxJumpHold&&player.vy<0){
player.vy-=0.3;
player.jumpHold++;
}

player.vy+=gravity;
player.x+=player.vx;
player.y+=player.vy;

// collisions
player.onGround=false;
player.touchingWall=false;

for(const p of lvl.platforms){

// wall detection
if(player.x+player.w>p.x && player.x<p.x+p.w &&
player.y+player.h>p.y && player.y<p.y+p.h){

// landing
if(player.vy>=0 && player.y+player.h<p.y+15){
player.y=p.y-player.h;
player.vy=0;
player.onGround=true;
player.jumpsLeft=2;
}

// hit left wall
if(player.x+player.w>p.x && player.x<p.x && !player.onGround){
player.touchingWall=true;
}

// hit right wall
if(player.x<p.x+p.w && player.x+player.w>p.x+p.w && !player.onGround){
player.touchingWall=true;
}
}
}

// boss logic
if(lvl.theme==="boss" && boss){
boss.cooldown--;
if(boss.cooldown<=0){
boss.cooldown=60;
bossShots.push({
x:boss.x,
y:boss.y+10,
vx:-5
});
}

// shots move
for(let s of bossShots){
s.x+=s.vx;

// hit player
if(player.x<s.x+10&&player.x+player.w>s.x&&
player.y<s.y+10&&player.y+player.h>s.y){
resetLevel();
}
}

// win if reach boss
if(player.x>boss.x-20 && player.y>boss.y-20){
boss.hp--;
player.vx=-6;
if(boss.hp<=0) nextLevel();
}
}

// goal for non-boss
if(lvl.theme!=="boss"){
let g=lvl.goal;
if(player.x<g.x+g.w&&player.x+player.w>g.x&&
player.y<g.y+g.h&&player.y+player.h>g.y){
nextLevel();
}
}

if(player.y>600) resetLevel();
}

function draw(){
ctx.clearRect(0,0,900,500);

if(finished){
ctx.fillStyle="white";
ctx.font="50px Arial";
ctx.fillText("YOU BEAT THE GAME",220,220);
let t=((performance.now()-startTime)/1000).toFixed(2);
ctx.font="30px Arial";
ctx.fillText("Time: "+t+"s",380,270);
ctx.fillText("Deaths: "+deaths,370,310);
return;
}

let lvl=levels[levelIndex];

// backgrounds
const bg={
grass:"#203d20",
ice:"#1e3f5a",
walljump:"#2e243f",
lava:"#3a1a1a",
boss:"#000"
};
ctx.fillStyle=bg[lvl.theme]||"#222";
ctx.fillRect(0,0,900,500);

// platforms
ctx.fillStyle="#888";
for(const p of lvl.platforms)
ctx.fillRect(p.x,p.y,p.w,p.h);

// boss
if(lvl.theme==="boss" && boss){
ctx.fillStyle="purple";
ctx.fillRect(boss.x,boss.y,boss.w,boss.h);

ctx.fillStyle="red";
for(let s of bossShots) ctx.fillRect(s.x,s.y,10,10);

ctx.fillStyle="white";
ctx.fillText("Boss HP: "+boss.hp,700,30);
}

// goal
if(lvl.theme!=="boss"){
ctx.fillStyle="lime";
let g=lvl.goal;
ctx.fillRect(g.x,g.y,g.w,g.h);
}

// player
ctx.fillStyle="cyan";
ctx.fillRect(player.x,player.y,player.w,player.h);

// UI
let t=((performance.now()-startTime)/1000).toFixed(2);
ctx.fillStyle="white";
ctx.font="18px Arial";
ctx.fillText("Time: "+t,10,20);
ctx.fillText("Deaths: "+deaths,10,40);
ctx.fillText("Level "+(levelIndex+1)+"/5",10,60);
ctx.fillText("Wall jump enabled",10,80);
}

function loop(){update();draw();requestAnimationFrame(loop);}
loop();
</script>
</body>
</html>
